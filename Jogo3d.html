<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo de Corrida 3D</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #overlay {
      position: absolute; top:0; left:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      flex-direction:column; background:black; color:white;
      font-size:60px; font-family:Arial, sans-serif; cursor:pointer;
    }
    #gameOver {
      display:none; flex-direction:column; align-items:center; justify-content:center;
      position:absolute; top:0; left:0; width:100%; height:100%;
      background:black; color:white; font-size:60px;
    }
    #restart {
      margin-top:20px; padding:10px 20px; font-size:24px; cursor:pointer;
    }
    #score {
      position:absolute; top:10px; left:10px; color:white;
      font-size:24px; font-family:Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="overlay">Clique para começar</div>
  <div id="score">Score: 0</div>
  <div id="gameOver">
    <div>GAME OVER</div>
    <button id="restart">Reiniciar</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
    let scene, camera, renderer;
    let player, obstacles = [], dashedLines = [];
    let moveDir = 0;
    let speed = 0.15;
    let obstacleSpeed = 0.5;
    let obstacleInterval = 1500;
    let lastObstacleTime = 0;
    let score = 0, startTime;
    let gameRunning = false;

    const overlay = document.getElementById("overlay");
    const gameOverDiv = document.getElementById("gameOver");
    const restartBtn = document.getElementById("restart");
    const scoreDiv = document.getElementById("score");

    const bgMusic = new Audio("musica.mp3");
    bgMusic.loop = true;
    bgMusic.volume = 0.3;
    const crashSound = new Audio("crash.mp3");
    const beepSound = new Audio("beep.mp3");
    const startSound = new Audio("start.mp3");

    // ==== Carro Azul (Jogador) ====
    function createPlayerCar() {
      const playerGroup = new THREE.Group();

      // Corpo
      const body = new THREE.Mesh(new THREE.BoxGeometry(1,0.5,2), new THREE.MeshStandardMaterial({color:0x0000ff}));
      body.position.y = 0.5; playerGroup.add(body);

      // Rodas
      const wheelGeom = new THREE.CylinderGeometry(0.2,0.2,0.1,16);
      const wheelMat = new THREE.MeshStandardMaterial({color:0x000000});
      [[-0.5,0.2,0.9],[0.5,0.2,0.9],[-0.5,0.2,-0.9],[0.5,0.2,-0.9]].forEach(p=>{
        const w = new THREE.Mesh(wheelGeom, wheelMat);
        w.rotation.z = Math.PI/2;
        w.position.set(p[0],p[1],p[2]);
        playerGroup.add(w);
      });

      // Vidro
      const glass = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.3,0.4),
        new THREE.MeshStandardMaterial({color:0x00ffff, transparent:true, opacity:0.6}));
      glass.position.set(0,0.9,-0.3);
      playerGroup.add(glass);

      // Faróis
      const lightGeom = new THREE.BoxGeometry(0.1,0.1,0.1);
      const frontMat = new THREE.MeshStandardMaterial({color:0xffffff});
      const backMat = new THREE.MeshStandardMaterial({color:0xff0000});
      [[-0.35,0.6,-1.05,frontMat],[0.35,0.6,-1.05,frontMat],
       [-0.35,0.6,1.05,backMat],[0.35,0.6,1.05,backMat]].forEach(l=>{
         const light = new THREE.Mesh(lightGeom,l[3]);
         light.position.set(l[0],l[1],l[2]);
         playerGroup.add(light);
       });
      return playerGroup;
    }

    // ==== Carro Vermelho (Inimigo) ====
    function createEnemyCar() {
      const group = new THREE.Group();
      const body = new THREE.Mesh(new THREE.BoxGeometry(1,0.5,2), new THREE.MeshStandardMaterial({color:0xff0000}));
      body.position.y = 0.5; group.add(body);

      const wheelGeom = new THREE.CylinderGeometry(0.2,0.2,0.1,16);
      const wheelMat = new THREE.MeshStandardMaterial({color:0x000000});
      [[-0.5,0.2,0.9],[0.5,0.2,0.9],[-0.5,0.2,-0.9],[0.5,0.2,-0.9]].forEach(p=>{
        const w = new THREE.Mesh(wheelGeom, wheelMat);
        w.rotation.z = Math.PI/2;
        w.position.set(p[0],p[1],p[2]);
        group.add(w);
      });

      const glass = new THREE.Mesh(new THREE.BoxGeometry(0.8,0.3,0.4),
        new THREE.MeshStandardMaterial({color:0x00ffff, transparent:true, opacity:0.6}));
      glass.position.set(0,0.9,-0.3); group.add(glass);

      const lightGeom = new THREE.BoxGeometry(0.1,0.1,0.1);
      const frontMat = new THREE.MeshStandardMaterial({color:0xffffff});
      const backMat = new THREE.MeshStandardMaterial({color:0xff0000});
      [[-0.35,0.6,-1.05,frontMat],[0.35,0.6,-1.05,frontMat],
       [-0.35,0.6,1.05,backMat],[0.35,0.6,1.05,backMat]].forEach(l=>{
         const light = new THREE.Mesh(lightGeom,l[3]);
         light.position.set(l[0],l[1],l[2]);
         group.add(light);
       });
      return group;
    }

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      camera.position.set(0,2,5); camera.lookAt(0,0,0);
      renderer = new THREE.WebGLRenderer(); renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const light = new THREE.DirectionalLight(0xffffff,1); light.position.set(0,5,5); scene.add(light);

      const ground = new THREE.Mesh(new THREE.PlaneGeometry(10,200), new THREE.MeshStandardMaterial({color:0x333333}));
      ground.rotation.x = -Math.PI/2; scene.add(ground);

      createSideLines();
      createDashedLines();

      player = createPlayerCar(); scene.add(player); player.position.set(0,0,0);

      document.addEventListener("keydown", e=>{if(e.key==="ArrowLeft") moveDir=-1; if(e.key==="ArrowRight") moveDir=1;});
      document.addEventListener("keyup", e=>{if(e.key==="ArrowLeft"||e.key==="ArrowRight") moveDir=0;});

      restartBtn.onclick = ()=>location.reload();

      overlay.addEventListener("click", ()=>{
        if(!gameRunning){
          [bgMusic, crashSound, beepSound, startSound].forEach(sound=>{
            sound.load(); sound.play().then(()=>{ sound.pause(); sound.currentTime=0; }).catch(()=>{});
          });
          startCountdown();
        }
      },{once:true});
    }

    function createSideLines() {
      const geom = new THREE.PlaneGeometry(0.1,200);
      const mat = new THREE.MeshStandardMaterial({color:0xffffff, side:THREE.DoubleSide});
      const left = new THREE.Mesh(geom,mat); left.rotation.x=-Math.PI/2; left.position.set(-3,0.01,-90);
      const right = new THREE.Mesh(geom,mat); right.rotation.x=-Math.PI/2; right.position.set(3,0.01,-90);
      scene.add(left,right);
    }

    function createDashedLines() {
      dashedLines.forEach(l=>scene.remove(l));
      dashedLines=[];
      const mat = new THREE.MeshStandardMaterial({color:0xffffff});
      for(let z=-100; z<100; z+=5){
        const line = new THREE.Mesh(new THREE.BoxGeometry(0.2,0.05,2), mat);
        line.position.set(0,0.025,z);
        scene.add(line);
        dashedLines.push(line);
      }
    }

    function spawnObstacle() {
      const obs = createEnemyCar();
      const lanes = [-2,0,2]; const lane=lanes[Math.floor(Math.random()*lanes.length)];
      obs.position.set(lane,0,-100); scene.add(obs); obstacles.push(obs);
    }

    function startCountdown() {
      let count=3; overlay.style.display="flex";
      const interval=setInterval(()=>{
        overlay.innerText = count>0?count:"START";
        if(count>0) beepSound.play();
        if(count===0){
          startSound.play();
          setTimeout(()=>{ overlay.style.display="none"; gameRunning=true; startTime=performance.now(); bgMusic.play(); animate(); },500);
          clearInterval(interval);
        }
        count--;
      },1000);
    }

    function gameOver(){
      gameRunning=false; bgMusic.pause(); crashSound.play(); gameOverDiv.style.display="flex";
    }

    function animate(timestamp){
      requestAnimationFrame(animate); if(!gameRunning) return;
      score=Math.floor((timestamp-startTime)/100); scoreDiv.innerText=`Score: ${score}`;
      obstacleSpeed = 0.5 + (score/700);
      player.position.x+=moveDir*speed; if(player.position.x<-2) player.position.x=-2; if(player.position.x>2) player.position.x=2;

      if(!lastObstacleTime) lastObstacleTime=timestamp;
      if(timestamp-lastObstacleTime>obstacleInterval){ spawnObstacle(); lastObstacleTime=timestamp; }

      for(let i=obstacles.length-1;i>=0;i--){
        const obs=obstacles[i];
        obs.position.z+=obstacleSpeed;
        if(obs.position.z>5){ scene.remove(obs); obstacles.splice(i,1); }
        if(Math.abs(obs.position.z-player.position.z)<1.5 && Math.abs(obs.position.x-player.position.x)<1){ gameOver(); }
      }

      dashedLines.forEach(line=>{
        line.position.z+=obstacleSpeed;
        if(line.position.z>5) line.position.z=-100;
      });

      renderer.render(scene,camera);
    }

    init();
  </script>
</body>
</html>

